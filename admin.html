<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | HusmaFit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Poppins', sans-serif; background: #111827; color: white; }
    .table { @apply w-full text-left border-collapse; }
    .th { @apply px-4 py-3 bg-gray-800 border-b border-gray-700 font-bold text-sm; }
    .td { @apply px-4 py-3 border-b border-gray-700 text-sm; }
    .badge { @apply inline-block px-3 py-1 rounded-full text-xs font-bold; }
    .modal { @apply fixed inset-0 bg-black/80 flex items-center justify-center z-50; }
    .modal-content { @apply bg-gray-800 p-8 rounded-xl max-w-sm w-full mx-4 shadow-2xl; }
    .logout-btn { @apply bg-red-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-700 transition flex items-center gap-2; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex justify-center items-center">

  <!-- PAROL OYNASI -->
  <div id="login-modal" class="modal flex flex-col justify-center items-center">
    <div class="modal-content flex flex-col justify-center items-center">
      <div class="text-center mb-6">
        <i class="fas fa-shield-alt text-5xl text-red-600 mb-3"></i>
        <h2 class="text-2xl font-bold">Admin Panel</h2>
        <p class="text-sm text-gray-400 mt-1">Parolni kiriting</p>
      </div>
      <input type="password" id="password" placeholder="Parol" class="w-full px-4 py-3 bg-gray-700 rounded-lg text-white mb-4 focus:ring-2 focus:ring-red-600 outline-none" />
      <button onclick="login()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition mb-2">
        Kirish
      </button>
      <button onclick="logoutToHome()" class="w-full logout-btn">
        <i class="fas fa-sign-out-alt"></i> Bosh sahifaga qaytish
      </button>
    </div>
  </div>

  <!-- ADMIN PANEL -->
  <div id="admin-panel" class="hidden">
    <!-- Header -->
    <header class="bg-gray-800 py-4 px-6 shadow-lg border-b border-gray-700 fixed top-0 left-0 w-full z-40">
      <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold">Husma<span class="text-red-600">Fit</span> Admin</h1>
        <button onclick="logout()" class="logout-btn">
          <i class="fas fa-sign-out-alt"></i> Chiqish
        </button>
      </div>
    </header>

    <!-- Kontent -->
    <section class="pt-24 pb-10 px-4">
      <div class="container mx-auto">
        <div class="bg-gray-800 rounded-xl shadow-xl p-6">
          <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
            <i class="fas fa-users text-green-500"></i> Ro‘yxatdan o‘tganlar
          </h2>

          <!-- Qidiruv -->
          <input type="text" id="search" placeholder="Ism yoki telefon bo‘yicha qidirish..." class="w-full mb-4 px-4 py-2 bg-gray-700 rounded-lg text-white focus:ring-2 focus:ring-red-600 outline-none">

          <div class="overflow-x-auto">
            <table class="table">
              <thead>
                <tr>
                  <th class="th">№</th>
                  <th class="th">Ism</th>
                  <th class="th">Telefon</th>
                  <th class="th">Abonement</th>
                  <th class="th">Sana</th>
                  <th class="th">Holati</th>
                  <th class="th">Amal</th>
                </tr>
              </thead>
              <tbody id="registrations-table"></tbody>
            </table>
          </div>

          <div id="empty" class="text-center py-10 text-gray-500">
            <i class="fas fa-inbox text-4xl mb-3"></i>
            <p>Hozircha hech kim ro‘yxatdan o‘tmagan</p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const CORRECT_PASSWORD = "husmafit2025";

    // Kirish
    function login() {
      const input = document.getElementById('password').value.trim();
      const modal = document.getElementById('login-modal');
      if (input === CORRECT_PASSWORD) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.getElementById('admin-panel').classList.remove('hidden');
        loadRegistrations();
      } else {
        alert('Noto‘g‘ri parol!');
      }
    }
function logout() {
  document.getElementById('admin-panel').classList.add('hidden');
  const modal = document.getElementById('login-modal');
  modal.classList.remove('hidden');
  modal.classList.add('flex'); // qo‘shildi
  document.getElementById('password').value = '';
}

    function logoutToHome() {
      window.location.href = "index.html";
    }

    // Ro‘yxatni yuklash
    function loadRegistrations() {
      const registrations = JSON.parse(localStorage.getItem('registrations') || '[]');
      const table = document.getElementById('registrations-table');
      const empty = document.getElementById('empty');
      const search = document.getElementById('search').value.toLowerCase();

      const filtered = registrations.filter(reg => 
        reg.name.toLowerCase().includes(search) || 
        reg.phone.includes(search)
      );

      if (filtered.length === 0) {
        empty.classList.remove('hidden');
        table.innerHTML = '';
        return;
      }

      empty.classList.add('hidden');
      table.innerHTML = '';

      filtered.forEach((reg, index) => {
        const planText = reg.plan === '50000' ? '1 kun – 50 000 so‘m' :
                        reg.plan === '450000' ? '1 oy – 450 000 so‘m' :
                        '1 yil – 4 500 000 so‘m';

        const badgeColor = reg.plan === '50000' ? 'bg-blue-600' :
                          reg.plan === '450000' ? 'bg-yellow-600' :
                          'bg-green-600';

        let statusBadge = '<span class="badge bg-orange-600">Kutilmoqda</span>';
        let actionButton = `<button onclick="markAsPaid(${registrations.indexOf(reg)})" class="text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">Kelganda to‘lanadi</button>`;

        if (reg.paid) {
          statusBadge = '<span class="badge bg-green-600">Kelganda to‘landi</span>';
          actionButton = '<span class="text-xs text-green-400">To‘landi</span>';
        }

        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-700 transition';
        row.innerHTML = `
          <td class="td">${registrations.indexOf(reg) + 1}</td>
          <td class="td font-semibold">${reg.name}</td>
          <td class="td">
            <a href="tel:${reg.phone}" class="text-green-400 hover:underline">${reg.phone}</a>
          </td>
          <td class="td">
            <span class="badge ${badgeColor}">${planText}</span>
          </td>
          <td class="td text-xs text-gray-400">${reg.date}</td>
          <td class="td">${statusBadge}</td>
          <td class="td">${actionButton}</td>
        `;
        table.appendChild(row);
      });
    }

    // To‘landi
    function markAsPaid(index) {
      let registrations = JSON.parse(localStorage.getItem('registrations') || '[]');
      registrations[index].paid = true;
      registrations[index].paidDate = new Date().toLocaleString('uz-UZ');
      localStorage.setItem('registrations', JSON.stringify(registrations));
      loadRegistrations();
    }

    // Qidiruv
    document.getElementById('search').addEventListener('input', loadRegistrations);

    // Yangilash
    setInterval(() => {
      if (!document.getElementById('admin-panel').classList.contains('hidden')) {
        loadRegistrations();
      }
    }, 3000);

    // Enter bosilganda kirish
    document.getElementById('password').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') login();
    });
  </script>
</body>
</html>
